# API управления пользователями

## Обзор

Этот проект представляет собой REST API на основе Django для управления информацией о людях. Он интегрируется с внешними сервисами для обогащения данных о пользователях, таких как возраст, пол и национальность, а также включает дополнительные возможности, такие как хранение электронной почты и установление дружеских связей.

## Возможности

### Основные функции
1. **Получение информации по фамилии**: Позволяет получить детальную информацию о людях на основе их ФИО.
2. **Интеграция с внешними сервисами**: Автоматически получает возраст, пол и национальность через внешние API:
   - [Agify.io](https://agify.io)
   - [Genderize.io](https://genderize.io)
   - [Nationalize.io](https://nationalize.io)

### Дополнительные функции
1. **Управление электронной почтой**: Каждый человек может иметь несколько связанных почтовых адресов.
2. **CRUD-операции**: Эндпоинты для создания, получения, обновления и удаления пользователей.
3. **Дружеские отношения**: Возможность устанавливать и управлять дружескими связями между пользователями.
4. **Документация Swagger**: Предоставляется интерактивная документация API.

## Технологический стек
- **Backend**: Django, Django REST Framework
- **Очередь задач**: Celery с Redis в качестве брокера
- **База данных**: PostgreSQL 
- **Кэширование**: LocMemCache (можно заменить на другие решения)
- **Контейнеризация**: Docker
- **Документация API**: drf-spectacular (Swagger)

> PostgreSQL выбрана с целью возможного масштабирования проекта, поддержку реляционной структуры данных, поиск фамилии по индексам.

## Установка

### Шаги установки

1. Клонируйте репозиторий:
   ```bash
   git clone git@github.com:ThatCoderMan/RedSoftTestTask.git
   cd RedSoftTestTask
   ```

2. Создайте файл `.env` со следующими переменными:
   ```env
   SECRET_KEY=<ваш_секретный_ключ>
   DJANGO_DEBUG=True
   POSTGRES_DB=django
   POSTGRES_USER=django
   POSTGRES_PASSWORD=django
   POSTGRES_HOST=localhost
   POSTGRES_PORT=5432
   CELERY_BROKER_URL=redis://redis:6379/0
   CELERY_RESULT_BACKEND=redis://redis:6379/0
   ```

3. Сборка и запуск базы данных и брокера:
   ```bash
   docker-compose up --build
   ```

4. Примените миграции:
   ```bash
   docker-compose exec web python manage.py migrate
   ```

5. Запуск приложения из папки `src`:
   ```bash
   python manage.py runserver
   ```
   
6. Запуск брокера из папки `src`:
   ```bash
   celery -A config.celery_app worker -l info 
   ```

7. Доступ к приложению:
   - **Документация API**: [http://localhost/api/docs/](http://localhost/api/docs/)

## Эндпоинты API

### Эндпоинты

#### Управление пользователями
1. **Получить всех пользователей**:  
   `GET /people/`

2. **Создать пользователя**:  
   `POST /people/`

3. **Получить пользователя по ID**:  
   `GET /people/{id}/`

4. **Обновить информацию о пользователе**:  
   `PUT /people/{id}/`

5. **Частичное обновление информации**:  
   `PATCH /people/{id}/`

6. **Поиск по фамилии**:  
   `GET /people/search?last_name={last_name}`

#### Управление дружескими связями
1. **Получить друзей пользователя**:  
   `GET /people/{id}/friends/`

2. **Добавить друга**:  
   `POST /people/{id}/add-friend/`

3. **Удалить друга**:  
   `POST /people/{id}/remove-friend/`

#### Поиск по фамилии
1. **Поиск людей по фамилии**
   `GET /people/search/`
